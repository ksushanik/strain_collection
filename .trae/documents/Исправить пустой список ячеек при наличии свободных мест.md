## Диагностика на живых данных
- Проверить ответ `GET /api/storage/boxes/{box_id}/cells/` для выбранного бокса в DevTools → Network (ожидаем массив `cells` с `id`, `cell_id`).
- Если массив пуст, проверить `GET /api/storage/boxes/{box_id}/detail/` — поле `cells_grid` (ожидаем свободные клетки с ненулевым `storage_id`).
- Сопоставить со сводкой `GET /api/storage/` для того же бокса: `free_cells` должен быть > 0.

## Исправления backend
1. Усилить консистентность снапшотов:
- В `storage_box_details` перед `build_storage_snapshot(...)` вызвать `ensure_storage_cells(box_id, rows, cols)` — как уже сделано для `get_box_cells` и `get_storage_box`, но теперь и для детального эндпоинта.
- Если `free_cells_sorted` пуст и `stats.free_cells > 0`, сформировать список свободных ячеек из `sorted_cells` (фильтр `not occupied`) — это устранит редкие случаи рассинхрона.

2. Единообразные пути и коды:
- Гарантировать одинаковый формат `box_id` (строка), без зависимости от регистра; уже используется `upper()`, оставить как есть.

## Исправления frontend (точечные)
- В `StorageManager.loadCells`: если `response.cells` пуст и `selectedBox.free_cells > 0`, дополнить из `getBoxDetail` не только когда «меньше ожидаемого», но и когда «равно 0»; уже есть fallback, расширим условие и логирование.
- Добавить короткое уведомление пользователю, когда ожидались свободные ячейки, но список пуст (помогает оперативной диагностике на проде).

## Проверка
- Создать тестовый бокс (например, `5`) с `rows×cols = 9×9`, убедиться:
  - `GET /api/storage/boxes/5/` → `free_cells` совпадает с фактом.
  - `GET /api/storage/boxes/5/cells/` → возвращает 2 клетки.
  - Фронтенд модалка редактирования образца при выборе бокса `5` показывает список ячеек.

## Роллбек/безопасность
- Все изменения обратимы, затрагивают только сериализацию и инициализацию клеток.
- Данные не модифицируются, создаются только недостающие записи `Storage` согласно геометрии бокса.

Подтвердите план — применю изменения и проведу проверку на вашем окружении.