# Руководство по доступу к API

## Проблема

При прямом обращении к backend контейнеру на порту 8000 возникает ошибка подключения к базе данных:

```
{"error":"Ошибка получения списка образцов: connection to server at \"localhost\" (::1), port 5433 failed: FATAL: password authentication failed for user \"strain_user\""}
```

## Причина

Когда пользователи обращаются напрямую к `http://127.0.0.1:8000/api/samples/`, они обходят nginx proxy и обращаются напрямую к Django приложению, которое использует настройки по умолчанию для подключения к базе данных (`localhost:5433`), а не к Docker контейнеру базы данных.

## Правильное решение

### ✅ Правильный способ доступа к API

Используйте порт **80** для всех API запросов:

```bash
# Правильно - через nginx proxy
curl "http://127.0.0.1:80/api/samples/"
curl "http://localhost:80/api/samples/"
curl "http://localhost/api/samples/"  # порт 80 по умолчанию
```

### ❌ Неправильный способ доступа

НЕ используйте прямой доступ к порту 8000:

```bash
# Неправильно - прямой доступ к backend
curl "http://127.0.0.1:8000/api/samples/"  # Вызовет ошибку БД
```

## Архитектура приложения

```
Пользователь → nginx (порт 80) → backend (порт 8000) → PostgreSQL (порт 5432)
```

- **Frontend контейнер** (`strain_frontend`) работает на порту 80 и содержит nginx
- **Backend контейнер** (`strain_backend`) работает на порту 8000 (только внутри Docker сети)
- **Database контейнер** (`strain_db`) работает на порту 5432 (только внутри Docker сети)

## Доступные эндпоинты

Все API эндпоинты доступны через порт 80:

- `GET http://localhost/api/samples/` - список образцов
- `GET http://localhost/api/strains/` - список штаммов
- `GET http://localhost/api/storage/` - информация о хранении
- `GET http://localhost/docs/` - документация API (Swagger)

## Проверка работоспособности

Для проверки правильной работы API используйте:

```bash
# Проверка здоровья приложения
curl "http://localhost/api/health/"

# Получение списка образцов
curl "http://localhost/api/samples/" | jq

# Проверка документации
curl "http://localhost/docs/"
```

## Важные замечания

- Порт 8000 backend контейнера НЕ экспонирован наружу в docker-compose.yml
- Все внешние запросы должны идти через nginx на порту 80
- Прямой доступ к backend может работать в некоторых конфигурациях, но приведет к ошибкам БД
- Используйте только официальные эндпоинты через порт 80

## Для разработчиков

При разработке и отладке всегда используйте:
- `http://localhost/api/` для API запросов
- `http://localhost/docs/` для документации
- `http://localhost/` для веб-интерфейса

Это обеспечит корректную работу всех компонентов системы.
